# 性能测试
### 实施阶段
* 一般而言，只有在系统基础功能测试验证完成、系统趋于稳定的情况下，才会进行性能测试，否则性能测试是无意义的。

### 目的
* 功能测试是能不能用，性能测试是好不好用，通过一些技术手段去模拟真实场景，采集数据来验证是否好用

### 性能测试的手段
1. 基于代码级接口+多线程直接操作代码（适用于开发，单元测试之类的）
2. 基于协议级接口+多线程直接对服务器操作（主要方式!可以使用自己擅长的语言调用协议（http、websocket）请求来操作）
3. 客户端的资源占用情况，例如应用程序对终端机资源消耗：cpu、内存、电量等

### 性能测试核心
1. 基于协议级接口
2. 多线程（模拟大量用户）。通常一台电脑能够同时运行的线程数为500~2000个（主要与cpu有关、其次内存、硬盘、带宽等），如果要模拟大量用户实际上需要多台电脑协同完成
3. 真实场景（前两点为技术手段，这个需要依靠对系统业务的理解和对性能测试经验积累才能完成）

### 瓶颈
* 硬环境：带宽、CPU、硬盘、内存；软环境：服务器的内存使用率，代码算法优化

### 注意事项
* 不能让负载机和被测服务器以及数据库放在同一台电脑上，这样测试的数据没有意义
* 在实施测试时，尽量给更大的压力，环境和负载要求更加严格一些
* 正常情况下，在设计Ramp Up和Ramp Down及Duration的时间，可以按照45度角来设计。
* 关于响应时间的问题：2-5-8-10原则
* 资源利用率：75%以内，太高容易达到瓶颈，太低资源浪费
* 在进行高并发测试时（公网），一定要确保客户端本身的资源不存在瓶颈，比如带宽

### 性能脚本调试过程
1. 单用户，单循环：调试基本用能
2. 单用户，多循环：调试一些数据重复的场景
3. 多用户，单循环：调试多线程并发
4. 多用户，多循环：模拟用户场景的实际情况

### 性能测试关注点
* 目的为了发现系统存在的问题并及时修复，以确保系统能够稳定运行，能够正常处理业务，使用用户体验更好，让客户对系统产生信心，能够成功交付运行。
* 主要评估以下关注点：
    * 客户端响应时间是否满足要求
    * 服务器资源使用情况是否合理
    * 应用服务器和数据服务器资源使用是否合理
    * 最大访问数，最大业务处理量多少
    * 系统存在瓶颈在哪里
    * 能否支持7*24小时的业务访问
    * 架构和数据库设计是否合理
    * 内存和线程资源是否能被正常回收
    * 代码或SQL语句是否存在性能问题
    * 如果系统出现不稳定情况，恢复性如何
* 不同角度
  1. 客户端：
     * 响应时间
     * 响应大小
     * 请求的响应成功率
  2. 服务端：
     1. 软件：
        * 最大线程数量、缓存的设置、连接池、线程池
     2. 硬件:        
        * CPU使用率：cpu使用率、cpu队列长度
        * 内存使用率：可用内存量、页交换频率（内存与硬盘之间数据交换频率）
        * 硬盘使用率：磁盘使用率、磁盘队列长度
        * 网卡流量：吞吐量
        * **上面硬件监控信息可以软件AIDA64，如果要记录输出相关记录直接可以使用windows系统自带的‘性能监视器’（可以将采集的数据输出csv文件）** 

### 性能测试的场景模型
1. 负载测试（用于评估最佳用户数，最大用户数）
2. 压力测试（利用大于最大用户的负载进行测试）
   * 对于线上系统存在触发防火墙机制的可能，所以通常要是用ip欺骗，jmeter、LR都有相关功能
3. 稳定性测试（标准用户，长时间，真场景）
4. 并发测试（模拟同时发请求），容量测试（模拟后台服务器端的大容量，数据库，硬盘，内存）
   * 3.为了更好地模拟并发测试，可以通过设置集合点进行。不符合真实场景，会存在额外的等待时间。